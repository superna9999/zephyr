/*
 * Copyright (c) 2016 Open-RnD Sp. z o.o.
 * Copyright (c) 2016 BayLibre, SAS
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#include <kernel.h>
#include <device.h>
#include <init.h>
#include <pinmux.h>
#include <sys_io.h>
#include "pinmux/pinmux.h"

#include "pinmux_stm32.h"

/* pin assignments for STM32L476G-DISCO board */
static const struct pin_config pinconf[] = {
#ifdef CONFIG_UART_STM32_PORT_1
	{STM32_PIN_PB6,  STM32L4X_PINMUX_FUNC_PB6_USART1_TX},
	{STM32_PIN_PG10, STM32L4X_PINMUX_FUNC_PG10_USART1_RX},
#endif	/* CONFIG_UART_STM32_PORT_1 */
#ifdef CONFIG_UART_STM32_PORT_2
	{STM32_PIN_PA2, STM32L4X_PINMUX_FUNC_PA2_USART2_TX},
	{STM32_PIN_PD6, STM32L4X_PINMUX_FUNC_PD6_USART2_RX},
#endif	/* CONFIG_UART_STM32_PORT_2 */
#ifdef CONFIG_I2C_1
	{STM32_PIN_PB8, STM32L4X_PINMUX_FUNC_PB8_I2C1_SCL},
	{STM32_PIN_PB7, STM32L4X_PINMUX_FUNC_PB7_I2C1_SDA},
#endif /* CONFIG_I2C_1 */
#ifdef CONFIG_PWM_STM32_2
	{STM32_PIN_PA0, STM32L4X_PINMUX_FUNC_PA0_PWM2_CH1},
#endif /* CONFIG_PWM_STM32_2 */
#ifdef CONFIG_STM32_FMC_NOR_SRAM_BANK_2
	{STM32_PIN_PD0, STM32L4X_PINMUX_FUNC_PD0_FMC_D2},
	{STM32_PIN_PD1, STM32L4X_PINMUX_FUNC_PD1_FMC_D3},
	{STM32_PIN_PD4, STM32L4X_PINMUX_FUNC_PD4_FMC_NOE},
	{STM32_PIN_PD5, STM32L4X_PINMUX_FUNC_PD5_FMC_NWE},
	{STM32_PIN_PD8, STM32L4X_PINMUX_FUNC_PD8_FMC_D13},
	{STM32_PIN_PD9, STM32L4X_PINMUX_FUNC_PD9_FMC_D14},
	{STM32_PIN_PD10, STM32L4X_PINMUX_FUNC_PD10_FMC_D15},
	{STM32_PIN_PD11, STM32L4X_PINMUX_FUNC_PD11_FMC_A16},
	{STM32_PIN_PD12, STM32L4X_PINMUX_FUNC_PD12_FMC_A17},
	{STM32_PIN_PD13, STM32L4X_PINMUX_FUNC_PD13_FMC_A18},
	{STM32_PIN_PE0, STM32L4X_PINMUX_FUNC_PE0_FMC_NBL0},
	{STM32_PIN_PE1, STM32L4X_PINMUX_FUNC_PE1_FMC_NBL1},
	{STM32_PIN_PE7, STM32L4X_PINMUX_FUNC_PE7_FMC_D4},
	{STM32_PIN_PE8, STM32L4X_PINMUX_FUNC_PE8_FMC_D5},
	{STM32_PIN_PE9, STM32L4X_PINMUX_FUNC_PE9_FMC_D6},
	{STM32_PIN_PE10, STM32L4X_PINMUX_FUNC_PE10_FMC_D7},
	{STM32_PIN_PE11, STM32L4X_PINMUX_FUNC_PE11_FMC_D8},
	{STM32_PIN_PE12, STM32L4X_PINMUX_FUNC_PE12_FMC_D9},
	{STM32_PIN_PE13, STM32L4X_PINMUX_FUNC_PE13_FMC_D10},
	{STM32_PIN_PE14, STM32L4X_PINMUX_FUNC_PE14_FMC_D11},
	{STM32_PIN_PE15, STM32L4X_PINMUX_FUNC_PE15_FMC_D12},
	{STM32_PIN_PF0, STM32L4X_PINMUX_FUNC_PF0_FMC_A0},
	{STM32_PIN_PF1, STM32L4X_PINMUX_FUNC_PF1_FMC_A1},
	{STM32_PIN_PF2, STM32L4X_PINMUX_FUNC_PF2_FMC_A2},
	{STM32_PIN_PF3, STM32L4X_PINMUX_FUNC_PF3_FMC_A3},
	{STM32_PIN_PF4, STM32L4X_PINMUX_FUNC_PF4_FMC_A4},
	{STM32_PIN_PF5, STM32L4X_PINMUX_FUNC_PF5_FMC_A5},
	{STM32_PIN_PF12, STM32L4X_PINMUX_FUNC_PF12_FMC_A6},
	{STM32_PIN_PF13, STM32L4X_PINMUX_FUNC_PF13_FMC_A7},
	{STM32_PIN_PF14, STM32L4X_PINMUX_FUNC_PF14_FMC_A8},
	{STM32_PIN_PF15, STM32L4X_PINMUX_FUNC_PF15_FMC_A9},
	{STM32_PIN_PG0, STM32L4X_PINMUX_FUNC_PG0_FMC_A10},
	{STM32_PIN_PG1, STM32L4X_PINMUX_FUNC_PG1_FMC_A11},
	{STM32_PIN_PG2, STM32L4X_PINMUX_FUNC_PG2_FMC_A12},
	{STM32_PIN_PG3, STM32L4X_PINMUX_FUNC_PG3_FMC_A14},
	{STM32_PIN_PG4, STM32L4X_PINMUX_FUNC_PG4_FMC_A14},
	{STM32_PIN_PG5, STM32L4X_PINMUX_FUNC_PG5_FMC_A15},
	{STM32_PIN_PG9, STM32L4X_PINMUX_FUNC_PG9_FMC_NCE},
#endif
};

static int pinmux_stm32_init(struct device *port)
{
	ARG_UNUSED(port);

	stm32_setup_pins(pinconf, ARRAY_SIZE(pinconf));

	return 0;
}

SYS_INIT(pinmux_stm32_init, PRE_KERNEL_1,
	 CONFIG_PINMUX_STM32_DEVICE_INITIALIZATION_PRIORITY);
